{
  "config": {
    "target": "https://localhost:3001",
    "phases": [
      {
        "name": "Warm up",
        "duration": 60,
        "arrivalRate": 10,
        "rampTo": 50
      },
      {
        "name": "Load test - Auth API",
        "duration": 300,
        "arrivalRate": 100
      },
      {
        "name": "Load test - Records API",
        "duration": 600,
        "arrivalRate": 200
      },
      {
        "name": "Load test - Bridge API",
        "duration": 300,
        "arrivalRate": 50
      },
      {
        "name": "Stress test - Peak load",
        "duration": 180,
        "arrivalRate": 1000
      },
      {
        "name": "Cool down",
        "duration": 60,
        "arrivalRate": 10
      }
    ],
    "payload": {
      "path": "./test/performance/test-data.csv",
      "fields": ["email", "password", "recordId", "patientId"]
    },
    "variables": {
      "authToken": ""
    },
    "processor": "./test/performance/load-test-processor.js",
    "http": {
      "timeout": 30,
      "pool": 50
    },
    "plugins": {
      "expect": {},
      "metrics-by-endpoint": {},
      "publish-metrics": [
        {
          "type": "json",
          "target": "./test-results/performance/artillery-report.json"
        },
        {
          "type": "html",
          "target": "./test-results/performance/artillery-report.html"
        }
      ]
    }
  },
  "scenarios": [
    {
      "name": "Authentication Load Test",
      "weight": 30,
      "flow": [
        {
          "post": {
            "url": "/api/v1/auth/login",
            "headers": {
              "Content-Type": "application/json"
            },
            "json": {
              "email": "{{ email }}",
              "password": "{{ password }}"
            },
            "capture": {
              "json": "$.token",
              "as": "authToken"
            },
            "expect": [
              {
                "statusCode": 200
              },
              {
                "hasProperty": "token"
              }
            ]
          }
        },
        {
          "think": 2
        }
      ]
    },
    {
      "name": "Medical Records Load Test",
      "weight": 40,
      "flow": [
        {
          "function": "authenticateUser"
        },
        {
          "get": {
            "url": "/api/v1/records",
            "headers": {
              "Authorization": "Bearer {{ authToken }}",
              "Content-Type": "application/json"
            },
            "expect": [
              {
                "statusCode": 200
              }
            ]
          }
        },
        {
          "post": {
            "url": "/api/v1/records",
            "headers": {
              "Authorization": "Bearer {{ authToken }}",
              "Content-Type": "application/json"
            },
            "json": {
              "patientId": "{{ patientId }}",
              "diagnosis": "Performance Test Diagnosis",
              "treatment": "Performance Test Treatment",
              "medications": ["Test Med 1", "Test Med 2"],
              "notes": "This is a performance test record"
            },
            "expect": [
              {
                "statusCode": [200, 201]
              }
            ]
          }
        },
        {
          "think": 1
        }
      ]
    },
    {
      "name": "Bridge Transfer Load Test",
      "weight": 20,
      "flow": [
        {
          "function": "authenticateUser"
        },
        {
          "post": {
            "url": "/api/v1/bridge/transfer",
            "headers": {
              "Authorization": "Bearer {{ authToken }}",
              "Content-Type": "application/json"
            },
            "json": {
              "recordId": "{{ recordId }}",
              "targetNetwork": "ethereum",
              "recipientAddress": "0x1234567890123456789012345678901234567890"
            },
            "expect": [
              {
                "statusCode": [200, 202]
              }
            ]
          }
        },
        {
          "think": 3
        }
      ]
    },
    {
      "name": "Monitoring and Analytics",
      "weight": 10,
      "flow": [
        {
          "function": "authenticateUser"
        },
        {
          "get": {
            "url": "/api/v1/monitoring/health",
            "headers": {
              "Authorization": "Bearer {{ authToken }}"
            },
            "expect": [
              {
                "statusCode": 200
              }
            ]
          }
        },
        {
          "get": {
            "url": "/api/v1/analytics/dashboard",
            "headers": {
              "Authorization": "Bearer {{ authToken }}"
            },
            "expect": [
              {
                "statusCode": 200
              }
            ]
          }
        }
      ]
    }
  ]
}